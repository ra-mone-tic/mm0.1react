# MeowMap - Сервис геокодирования для Калининграда

Этот проект направлен на создание легковесного веб-сервиса для отображения интерактивной карты, управления маркерами и выполнения геокодирования (адрес↔координаты) с минимальной зависимостью от платных внешних API, специально адаптированного для Калининграда (Россия).

## Роль
Старший full-stack разработчик (Python, JavaScript, SQL) с опытом в ГИС, картографии и инженерии данных.

## Локализация
Пользовательский интерфейс сервиса (все метки, элементы управления, сообщения и содержимое по умолчанию) выполнен на русском языке.

## Технический стек
- **Бэкенд:** Python (Flask)
- **Фронтенд:** Ванильный JS с Leaflet.js для карт
- **Данные:** SQLite (с возможностью миграции на PostGIS)

## Архитектура и компромиссы

### Структура директорий
- `/backend`: Содержит код приложения Flask, логику базы данных.
- `/frontend`: Содержит HTML, CSS и JavaScript для пользовательского интерфейса.
- `/data`: Хранит географические данные (например, `RU.txt` из GeoNames).
- `/utils`: Содержит служебные скрипты, такие как `load_geodata.py` для загрузки данных.

### Бэкенд (Flask)
- **`app.py`**: Основное приложение Flask, обрабатывает маршрутизацию и конечные точки API.
- **`database.py`**: Управляет взаимодействием с базой данных SQLite для маркеров и данных GeoNames.

### Фронтенд (Leaflet.js, Ванильный JS)
- **`index.html`**: Основная HTML-страница, которая загружает карту и обрабатывает взаимодействия с пользователем.
- Использует Leaflet.js для отображения интерактивной карты.

### Обработка данных
- **Данные карты**: Использует бесплатные тайлы карты из OpenStreetMap. Для продакшена рекомендуется кэширование тайлов или их самостоятельное размещение из-за политики использования публичных тайлов.
- **Данные геокодирования**: Использует предварительно загруженные и обработанные локальные наборы данных из GeoNames (`RU.txt`) для Калининграда и Калининградской области. Это позволяет выполнять геокодирование в автономном/почти автономном режиме, уменьшая зависимость от внешних API.

### Алгоритмы геокодирования
- **Обратное геокодирование**: При клике на карту/создании маркера ближайший соответствующий объект в пределах ограничивающего прямоугольника находится с использованием упрощенного расчета расстояния. Это дает приблизительный адрес/название места на русском языке.
- **Прямое геокодирование**: Строка поиска позволяет пользователям вводить название места (на русском языке). Бэкенд запрашивает таблицу geonames, используя `LIKE` для поиска совпадений, и возвращает кандидатов с координатами. Применяется простое ранжирование.

## Текущие ограничения
- **Точность геокодирования**: Текущая реализация геокодирования основана на данных GeoNames, которые могут иметь более грубую детализацию по сравнению с коммерческими сервисами, особенно для очень конкретных российских адресов.
- **Производительность с большими наборами данных**: Для очень больших наборов данных текущее геокодирование на основе SQLite может столкнуться с ограничениями производительности, особенно при запросах `LIKE`.

## Пути масштабирования
- **Миграция на PostGIS**: Для улучшения возможностей пространственных запросов и производительности с большими наборами данных, миграция базы данных geonames на PostGIS является естественным следующим шагом.
- **Elasticsearch для поиска**: Для более продвинутых и производительных возможностей полнотекстового поиска при прямом геокодировании было бы полезно интегрировать Elasticsearch.
- **Кэширование тайлов/самостоятельно размещенные тайлы**: Для соблюдения политики использования тайлов OSM и улучшения производительности загрузки карты, внедрение прокси-сервера кэширования тайлов или самостоятельное размещение тайлов имеет решающее значение для продакшена.
- **Пространственные индексы**: Использование пространственных индексов в SQLite (или PostGIS) значительно ускорит запросы геокодирования.
- **Индексы ограничивающих прямоугольников**: Внедрение более сложных индексов ограничивающих прямоугольников может дополнительно оптимизировать пространственный поиск.

## Как запустить
1. Убедитесь, что установлен Python 3.x.
2. Перейдите в корневую директорию проекта.
3. Установите зависимости:
   ```bash
   pip install Flask
   pip install pandas # для обработки данных в load_geodata.py
   ```
4. Загрузите `RU.zip` с `http://download.geonames.org/export/dump/RU.zip` и извлеките `RU.txt` в директорию `data/`.
5. Запустите скрипт загрузки данных:
   ```bash
   python3.11 utils/load_geodata.py
   ```
6. Запустите приложение Flask:
   ```bash
   python3.11 backend/app.py
   ```
7. Откройте браузер и перейдите по адресу `http://127.0.0.1:5000` (или по адресу, где запущено Flask-приложение).

## Комментарии к коду и модульность
- Код разделен на логические файлы (`app.py`, `database.py`, `load_geodata.py`, `index.html`).
- Каждый значимый блок (функции, нетривиальная логика, SQL) содержит комментарии, объясняющие ЧТО, ПОЧЕМУ и КАК.

## Настройки по умолчанию для Калининграда и русский интерфейс
- Карта по умолчанию центрирована на Калининграде, Россия.
- Все строки пользовательского интерфейса, примеры и обработка данных отдают приоритет русскоязычному контенту.

